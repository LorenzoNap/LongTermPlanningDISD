---
title: "JNB"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
runtime: shiny
---

```{r include=FALSE, cache=FALSE}
source("../parametriConnessioniFile.R")
source("dashScript.R")
library(dygraphs)
library(flexdashboard)
library(plotly)
library(Hmisc)
library(leaflet)
library(htmlwidgets)
library(shiny)

total <- data.frame("Categorie"=c("Regionali","Internazionali", "Domestici"),
                    "NumeroVoli"=c(
                      sum(reg.arr.aflight$CONTO) + sum(reg.dep.aflight$CONTO),
                      sum(int.arr.aflight$CONTO) + sum(int.dep.aflight$CONTO),
                      sum(dom.arr.aflight$CONTO) + sum(dom.dep.aflight$CONTO)
                   ))


rotte.agg3 <- createMap()

``` 

Statistiche Voli
===================================== 


Row {data-height=200}
-----------------------------------------------------------------------
### Regionali {.value-box}

```{r}
# dlCount is a reactive expression that keeps track of the total
# number of rows that have ever appeared through pkgStream.


# Emit the download count
renderValueBox({
  valueBox(total[1,]$NumeroVoli, icon = "fa-plane", color = "success")
})
```

### Internazionali {.value-box}

```{r}
# dlCount is a reactive expression that keeps track of the total
# number of rows that have ever appeared through pkgStream.


# Emit the download count
renderValueBox({
  valueBox(total[2,]$NumeroVoli, icon = "fa-plane", color = "orange")
})
```

### Domestici {.value-box}

```{r}
# dlCount is a reactive expression that keeps track of the total
# number of rows that have ever appeared through pkgStream.


# Emit the download count
renderValueBox({
  valueBox(total[3,]$NumeroVoli, icon = "fa-plane", color = "primary")
})
```

Row {data-height=650}
-------------------------------------

### Percentuali {data-width=300}
```{r}

p <- plot_ly(total, labels = ~Categorie, values = ~NumeroVoli, type = 'pie',
             textposition = 'inside',
        textinfo = 'label+percent',
        insidetextfont = list(color = '#FFFFFF'),
        hoverinfo = 'text',
        text = ~paste('Numero voli:', NumeroVoli),
        marker = list(colors = colors,
                      line = list(color = '#FFFFFF', width = 1))
             ) %>%
  layout(
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
p

```


### Mappa Voli

```{r}
library(leaflet)


  
  greenLeafIcon <- makeIcon(
    iconUrl = "http://icons.iconarchive.com/icons/paomedia/small-n-flat/96/map-marker-icon.png",
    iconWidth = 20, iconHeight = 20

  )
  
  m <- leaflet(data = rotte.agg3) %>% addTiles() %>%
    addMarkers(~LON2c, ~LAT2c, popup = ~as.character(DESCRIPTION1),
               icon =greenLeafIcon
               , label = ~as.character(DESCRIPTION1))
  m

# gauge(50, min = 0, max = 100, symbol = '%', gaugeSectors(
#   success = c(80, 100), warning = c(40, 79), danger = c(0, 39)
# ))
# 
# gauge(50, min = 0, max = 50, gaugeSectors(
#   success = c(41, 50), warning = c(21, 40), danger = c(0, 20)
# ))
# 
# gauge(50, min = 0, max = 10, gaugeSectors(
#   success = c(0, 2), warning = c(3, 6), danger = c(7, 10)
# ))
```


Row {.tabset .tabset-fade}
-------------------------------------
    
   
### Regionali Arrivo

```{r}
dygraph(reg.arr.db)
```   
 
### Regionali Partenze
    
```{r}
dygraph(reg.dep.db)
```


### Internazionali Arrivo
    
```{r}
dygraph(int.arr.db)
```
    
### Internazionali Partenze

```{r}
dygraph(int.dep.db)
```


### Domestici Arrivo
    
```{r}
dygraph(dom.arr.db)

```
    
### Domestici Partenze

```{r}
dygraph(dom.dep.db)

```



Previsioni
=====================================     

### Chart 1
    
```{r}
```
    
### Chart 2

```{r}
```